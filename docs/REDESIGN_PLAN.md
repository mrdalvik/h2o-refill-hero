# План редизайна главного экрана с автоматом

## Цель
Детализированный pixel art в стиле Stardew Valley при сохранении текущего дизайна как опции по умолчанию. Новый дизайн включается в настройках разработчика.

---

## Референс: Stardew Valley

### Ключевые принципы стиля
- **Сетка**: 16×16 или 32×32 пикселей как базовая единица
- **Палитра**: 6–8 цветов на спрайт, без чистого чёрного/белого
- **Контуры**: самый тёмный цвет — только по краям
- **Освещение**: сверху, лёгкий акцент слева
- **Детализация**: текстуры через форму и цвет, не через линии
- **Насыщенность**: яркие, сочные цвета

---

## Архитектура переключения

### 1. Хранение настройки
- **Ключ**: `STORAGE_KEYS.DETAILED_VENDING` (например `h2o-detailed-vending`)
- **Значение**: `'1'` — новый дизайн, иначе — старый
- **По умолчанию**: старый дизайн

### 2. Точка переключения
- **DevSettingsPopup**: добавить чекбокс/переключатель «Детализированный автомат» / «Detailed vending machine»
- **VendingMachine.vue**: читать флаг и рендерить либо `<VendingMachineClassic />`, либо `<VendingMachineDetailed />`

### 3. Структура компонентов
```
App.vue
├── DayBackground (классический) ИЛИ DayBackgroundDetailed (при detailedMode)
└── VendingMachine.vue (обёртка)
    ├── useDetailedVending() — composable для чтения флага
    ├── VendingMachineClassic (текущий контент)
    └── VendingMachineDetailed (новый дизайн)
        ├── VendingGridDetailed
        ├── VendingCellDetailed
        ├── BottleSpriteDetailed
        └── ...
```

Альтернатива: один компонент с `:class="detailedMode ? 'vending-detailed' : 'vending-classic'"` и условными стилями/подкомпонентами.

---

## Детализация по компонентам

### 1. Корпус автомата (VendingMachine)

**Текущее состояние:**
- Градиент `#e8e8f0 → #d0d0dc`
- Простая рамка 4px
- Базовые тени

**Stardew-стиль:**
- **Металлический корпус**: 3–4 оттенка серого для объёма (свет сверху, тень снизу)
- **Пиксельная текстура**: повторяющийся паттерн 4×4 для «металла»
- **Каннелюры/рёбра**: тонкие полоски по краям для глубины
- **Тени**: чёткие, блочные (не размытые), 1–2 пикселя смещения

### 2. Козырёк (machine-awning)

**Текущее состояние:**
- Красный градиент, простая полоска

**Stardew-стиль:**
- **Полосатый навес**: 2–3 оттенка красного, горизонтальные «доски» 4–6px
- **Складки ткани**: лёгкие тени под «волнами»
- **Крепления**: маленькие «болты» по углам (2×2px)
- **Подкладка**: тёмная полоска снизу с текстурой

### 3. Окно витрины (machine-window)

**Текущее состояние:**
- Тёмный градиент, простая рамка

**Stardew-стиль:**
- **Стекло**: 2–3 слоя «отражения» (светлые полосы под углом)
- **Рама**: двойная рамка — внешняя металл, внутренняя тёмная
- **Углы**: скругление через пиксели (не border-radius)
- **Глубина**: внутренняя тень как «углубление»

### 4. Полки (VendingGrid / VendingCell)

**Текущее состояние:**
- Линейные разделители, простой фон ячеек

**Stardew-стиль:**
- **Деревянные полки**: 3–4 оттенка коричневого (#8B7355, #6B5344, #A08060)
- **Текстура дерева**: горизонтальные «волокна» 1–2px
- **Тень под полкой**: тёмная полоска 2–3px
- **Спирали (SpiralCoil)**: более объёмные, с бликом и тенью
- **Пустые ячейки**: лёгкая «сетка» или пыль

### 5. Бутылки (BottleSprite)

**Текущее состояние:**
- CSS-блоки, 2–3 цвета на тип напитка

**Stardew-стиль:**
- **Вода**: 5–6 оттенков синего, блик на горлышке, тень на дне
- **Кофе**: металлическая банка с градиентом и бликом
- **Чай**: матовая бутылка, этикетка с контуром
- **Сок**: тетрапак с «складками» и бликом
- **Газировка**: банка с бликом и контрастной полосой
- **Общее**: outline 1px тёмным цветом, без чистого чёрного

### 6. Панель управления (ControlPanel)

**Текущее состояние:**
- Тёмный фон, зелёный дисплей

**Stardew-стиль:**
- **Корпус**: «пластик» с градиентом и лёгкой текстурой
- **Дисплей**: сегментный/ЖК-стиль, пиксельные «сегменты»
- **Кнопки нумпада**: объёмные, с тенью при нажатии
- **Кнопка настроек**: иконка-спрайт 16×16 вместо символа

### 7. Счётчик воды (WaterCounter)

**Текущее состояние:**
- Простая панель с текстом

**Stardew-стиль:**
- **Табличка**: деревянная или металлическая с рамкой
- **Шрифт**: имитация пиксельного LCD
- **Бейдж «Цель достигнута»**: маленький спрайт-иконка (звезда/галочка)

### 8. Прогресс-бар (ProgressIndicator)

**Текущее состояние:**
- Окно выдачи, синий/зелёный градиент

**Stardew-стиль:**
- **Окно выдачи**: глубокая «яма» с тенями
- **Полоска прогресса**: пиксельная заливка (не плавный градиент)
- **Эффект «воды»**: волнообразная текстура при заполнении

### 9. Фон (DayBackground)

Фон переключается вместе с автоматом: при включённом детализированном режиме используется `DayBackgroundDetailed`.

#### 9.1 Небо (sky-layer)

**Текущее состояние:**
- Линейные градиенты для утра/дня/вечера/ночи

**Stardew-стиль:**
- **Градиенты**: 4–5 ступеней вместо плавных, «пиксельные» полосы по 32–48px
- **Горизонт**: чёткая граница с землёй, лёгкая «дымка» 2–3 оттенка
- **Цвета**: насыщенные, без грязных переходов (утро: #FFD4A0, #FFE4B5, #FFF8DC; день: #87CEEB, #B0E0E6, #E0F7FA; вечер: #C77DBA, #E8A0BF, #FFB88C; ночь: #0C1445, #1A237E, #2C3E7A)

#### 9.2 Солнце (morning)

**Текущее состояние:**
- Квадрат 40×40 с box-shadow-лучами

**Stardew-стиль:**
- **Ядро**: 2–3 оттенка жёлтого (#FFD700, #FFA500, #FF8C00)
- **Лучи**: пиксельные «спайки» 4×4 или 8×8 по диагоналям
- **Ореол**: 1–2 слоя полупрозрачного свечения, ступенчато
- **Анимация**: лёгкое «дыхание» через изменение яркости, не размытия

#### 9.3 Облака (day)

**Текущее состояние:**
- Базовые box-shadow-облака, простые формы

**Stardew-стиль:**
- **Форма**: «пухлые» пиксельные облака, 3–4 «комка» на облако
- **Объём**: 4–5 оттенков белого/голубоватого (#fff, #f8f8ff, #e8f0f8, #d8e8f0)
- **Тени**: тёмная полоска снизу каждого «комка»
- **Количество**: 3–4 облака разного размера (32×16, 48×20, 64×24)
- **Движение**: сохранить, но траектории чуть разнообразить

#### 9.4 Закат (evening)

**Текущее состояние:**
- Радиальный градиент sunset-glow

**Stardew-стиль:**
- **Солнце на горизонте**: оранжевый диск с пиксельными лучами
- **Полоса заката**: горизонтальные полосы 24–32px (оранжевый, розовый, фиолетовый)
- **Отражение**: лёгкая «дорожка» на земле
- **Без размытия**: всё через чёткие блоки

#### 9.5 Звёзды (night)

**Текущее состояние:**
- 30 точек, twinkle-анимация

**Stardew-стиль:**
- **Размеры**: 2×2, 3×3, 4×4 пикселей (малые, средние, большие)
- **Цвета**: не чисто белый — #fffef0, #e8e8ff, #d0d8ff (тёплые/холодные)
- **Количество**: 40–50, распределение через seed для стабильности
- **Мерцание**: ступенчатое (3–4 уровня opacity), не плавное
- **Созвездия**: опционально 1–2 простых паттерна из линий

#### 9.6 Дерево

**Текущее состояние:**
- Ствол + 3 слоя листвы (box-shadow), rustle-анимация

**Stardew-стиль:**
- **Ствол**: 4–5 оттенков коричневого (#5c4033, #4a3328, #3d2a22, #2d1f18)
- **Кора**: вертикальные «трещины» 1–2px, тень с левой стороны
- **Ветки**: 2–3 видимые ветки, выступающие из листвы
- **Листва**: 5–6 слоёв вместо 3, разные оттенки зелёного (#228b22, #2d9d2d, #1a6b1a, #3cb371, #2e8b57)
- **Форма**: более «пушистая», как в Stardew — круглые «шапки»
- **Тени**: тёмные участки между слоями, освещение сверху-слева
- **Ночная версия**: синеватый оттенок (#1a2a2a, #0d1a0d), силуэт

#### 9.7 Земля (ground)

**Текущее состояние:**
- Сетка 24×24, линейные градиенты под «плитку»

**Stardew-стиль:**
- **Плитка/асфальт**: тайлы 16×16 или 32×32
- **Швы**: тёмные линии 1–2px между плитками
- **Вариация**: 2–3 варианта плиток (чуть светлее/темнее) для естественности
- **Трещины/пятна**: опционально 1–2 на 10 тайлов
- **Верхняя граница**: чёткий «бордюр» 2–4px, тень под ним
- **Время суток**: утро/день/вечер/ночь — 4 палитры (как сейчас, но детальнее)

#### 9.8 Птицы

**Текущее состояние:**
- Символы ›/‹, fly-анимация

**Stardew-стиль:**
- **Спрайт**: простой пиксельный силуэт 8×8 или 12×12 (крыло вверх/вниз)
- **Альтернатива**: оставить символы, но стилизовать под пиксель (чёткие края, 2–3 цвета)
- **Тень**: лёгкая тень под птицей при полёте
- **Вариация**: 2–3 типа птиц (размер/форма)

---

## Фон: цветовая палитра

```
Небо утро:   #FFD4A0, #FFE4B5, #FFF8DC, #FFEFD5
Небо день:   #87CEEB, #B0E0E6, #E0F7FA, #ADD8E6
Небо вечер:  #C77DBA, #E8A0BF, #FFB88C, #FFA07A
Небо ночь:   #0C1445, #1A237E, #2C3E7A, #1a1a3e

Солнце:      #FFD700, #FFA500, #FF8C00
Облака:      #ffffff, #f8f8ff, #e8f0f8, #d8e8f0
Звёзды:      #fffef0, #e8e8ff, #d0d8ff

Дерево:      #228b22, #2d9d2d, #1a6b1a, #3cb371, #2e8b57
Ствол:       #5c4033, #4a3328, #3d2a22, #2d1f18

Земля день:  #5a5a5a, #4a4a4a, #3a3a3a
Земля ночь:  #1a1a1a, #0d0d0d, #252530
```

---

## Технические решения

### Pixel-perfect
- `image-rendering: pixelated` везде
- Размеры кратны 2 или 4
- Масштабирование через `transform: scale()` при необходимости

### Цветовая палитра (новая)
```
Металл:    #e0e0e8, #c8c8d0, #a0a0b0, #787888
Дерево:    #a08060, #8b7355, #6b5344, #4a3828
Стекло:    #607080, #405060, #203040
Акцент:   #4ade80, #22c55e (без изменений)
```

### Производительность
- Новые компоненты — lazy load при первом включении
- Или статический импорт: переключение мгновенное, +~15–20KB

---

## Порядок реализации

1. **Инфраструктура**
   - Добавить `STORAGE_KEYS.DETAILED_VENDING`
   - Composable `useDetailedVending()`
   - Переключатель в DevSettingsPopup
   - Обёртка в VendingMachine с условным рендером

2. **Базовый новый автомат**
   - Скопировать VendingMachine → VendingMachineDetailed
   - Применить новые стили к корпусу, козырьку, окну

3. **Полки и ячейки**
   - VendingGridDetailed, VendingCellDetailed
   - Детализированные полки и спирали

4. **Бутылки**
   - BottleSpriteDetailed или расширить BottleSprite через prop `variant="detailed"`

5. **Панель и счётчик**
   - Детализированные версии ControlPanel, WaterCounter, ProgressIndicator

6. **Фон (DayBackgroundDetailed)**
   - Небо, солнце, облака, звёзды, закат
   - Дерево, земля, птицы

7. **Полировка**
   - Анимации, hover-эффекты
   - Адаптивность под мобильные

---

## Файлы для изменения/создания

| Действие | Файл |
|----------|------|
| Изменить | `src/constants/storageKeys.ts` |
| Создать | `src/composables/useDetailedVending.ts` |
| Изменить | `src/components/DevSettingsPopup.vue` |
| Изменить | `src/components/VendingMachine.vue` |
| Создать | `src/components/vending-detailed/VendingMachineDetailed.vue` |
| Создать | `src/components/vending-detailed/VendingGridDetailed.vue` |
| Создать | `src/components/vending-detailed/VendingCellDetailed.vue` |
| Создать/расширить | `src/components/vending-detailed/BottleSpriteDetailed.vue` или prop в BottleSprite |
| Создать | `src/components/vending-detailed/ControlPanelDetailed.vue` |
| Создать | `src/components/vending-detailed/WaterCounterDetailed.vue` |
| Создать | `src/components/vending-detailed/ProgressIndicatorDetailed.vue` |
| Создать | `src/components/DayBackgroundDetailed.vue` |
| Изменить | `src/App.vue` (условный рендер DayBackground / DayBackgroundDetailed) |
| Добавить | i18n ключи `devSettings.detailedVending` |

---

## Примечания

- Changelog и версия **не обновляются** (по требованию)
- Старый дизайн остаётся по умолчанию
- Переключатель доступен только через настройки разработчика (код 1998)
